---
title: "Project"
output: html_document
date: "`r Sys.Date()`"
---

```{r}
# Load libraries
library(tidyverse)
```

```{r}
# Load data
nepal = read_csv("nepal_dat.csv")
```

```{r}
# check for NAs
colSums(is.na(nepal))
```

```{r}
# check for column classes and split them
data.frame(
  class = sapply(nepal, class)
)

nepal_num = nepal |>
  select(where(is.numeric))
nepal_char= nepal |>
  select(where(is.character))
```

```{r}
# Numeric Plots
nepal_num_long <- nepal_num %>%
  pivot_longer(
    cols = everything(),
    names_to = "variable",
    values_to = "value"
  )

# Create boxplots for each numeric variable
ggplot(nepal_num_long, aes(x = variable, y = value)) +
  geom_boxplot(fill = "skyblue", color = "darkblue") +
  facet_wrap(~ variable, scales = "free") +
  theme(
    axis.text.x = element_blank(),
    axis.ticks.x = element_blank(),
    strip.text = element_text(size = 5),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold")
  ) +
  labs(
    title = "Boxplots of Numeric Variables in Nepal Dataset",
    x = "",
    y = "Value"
  )
```

# GLM

```{r}
library(MASS)

ord_model <- polr(
  damage_grade ~ geo_level_1_id + geo_level_2_id + geo_level_3_id +
    count_floors_pre_eq + age + area_percentage + height_percentage +
    land_surface_condition + foundation_type + roof_type +
    ground_floor_type + other_floor_type + position + plan_configuration +
    has_superstructure_cement_mortar_brick + has_superstructure_rc_engineered +
    has_superstructure_mud_mortar_stone + count_families + has_secondary_use,
  data = nepal,
  Hess = TRUE
)

summary(ord_model)
exp(coef(ord_model)) # odds ratios

```

```{r}
# Predicted values
preds <- predict(ord_model, newdata = nepal)

# Confusion matrix
confusionMatrix(preds, nepal$damage_grade)

```
